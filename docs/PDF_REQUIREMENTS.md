# PDF Requirements for Contract Intelligence

## Overview

The Contract Intelligence application can **only process text-based PDF documents**. It does not support OCR (Optical Character Recognition) for scanned or image-based documents.

## ✅ Supported PDF Types

The system works with PDFs that contain **extractable text**:

- PDFs created from Microsoft Word, Excel, or other office applications
- PDFs generated by legal document management software
- Digitally-created contracts and agreements
- PDFs exported from web applications
- Any PDF where you can select and copy text with your mouse

### Example: Testing Your PDF

1. Open the PDF in any PDF reader (Adobe Reader, browser, etc.)
2. Try to select text by clicking and dragging your mouse over it
3. **If you can select and copy text** → ✅ Your PDF will work
4. **If you cannot select text** → ❌ Your PDF is image-based

## ❌ Unsupported PDF Types

The system **cannot process** these types of files:

- **Scanned documents** (physical documents scanned to PDF)
- **Image-based PDFs** (PDFs containing only images of text)
- **Photo copies** converted to PDF format
- **Screenshots** saved as PDF
- **Faxed documents** saved as PDF

These files appear to be PDFs but contain images rather than text data.

## Why This Limitation?

The application uses the **PdfPig library** for text extraction, which reads text directly from the PDF's internal structure. This approach:

- ✅ Is fast and reliable for text-based PDFs
- ✅ Maintains formatting and page structure
- ✅ Works with multilingual content
- ❌ Cannot process image data without OCR

OCR support was intentionally excluded from the MVP to keep the system simple and focused.

## What Happens When Extraction Fails?

When you try to extract text from an unsupported PDF, you'll see an error like:

```
Extraction failed.
No text extracted from document. File may be empty, corrupted, or image-based PDF.
```

The application will display a helpful message with troubleshooting tips.

## Solutions for Image-Based PDFs

If you have scanned or image-based PDFs, you have several options:

### Option 1: Use OCR Software (Recommended)

Convert your image-based PDF to a text-based PDF using:

- **Adobe Acrobat Pro** (Recognize Text feature)
- **ABBYY FineReader**
- **Online OCR services** (e.g., ocr.space, onlineocr.net)
- **Google Drive** (Upload → Open with Google Docs → Download as PDF)

### Option 2: Request Original Documents

Ask for the original digital version of the contract before it was scanned.

### Option 3: Recreate the Document

If the document is short, consider recreating it in Word and exporting as PDF.

## Testing with Sample Documents

The repository includes a `sample_contract.pdf` in the storage folder that demonstrates the expected format. This is a text-based PDF generated by ReportLab that the system can successfully process.

## Technical Details

### Extraction Pipeline

1. **File Storage**: PDF is saved to disk with a unique path
2. **Text Extraction**: PdfPig reads text from each page
3. **Validation**: System checks if any text was extracted
4. **Clause Detection**: Regex patterns identify contract clauses
5. **Risk Scoring**: Detected clauses are analyzed for risk

### Error Handling

The extraction service provides specific error messages:

- `"File not found"` → Storage path issue
- `"No text extracted"` → Image-based or empty PDF
- `"Failed to extract text"` → Corrupted or invalid PDF file

## Backend Implementation

For developers, the text extraction logic is in:

- **Interface**: `src/Application/Interfaces/IPdfTextExtractionService.cs`
- **Implementation**: `src/Infrastructure/Services/PdfPigTextExtractionService.cs`
- **Orchestration**: `src/Infrastructure/Services/ContractExtractionService.cs`

The key validation happens here:

```csharp
if (string.IsNullOrWhiteSpace(textContent.FullText))
{
    throw new InvalidOperationException(
        $"No text extracted from document {latestDocument.FileName}. " +
        "File may be empty, corrupted, or image-based PDF.");
}
```

## Future Enhancements

Potential future additions (not in current MVP):

- [ ] OCR support for scanned documents using Tesseract
- [ ] Image preprocessing and cleanup
- [ ] Multi-format support (DOCX, TXT, etc.)
- [ ] Automatic PDF type detection
- [ ] Batch processing with mixed document types

## Getting Help

If you're still experiencing issues:

1. Verify your PDF is text-based using the selection test above
2. Check the browser console for detailed error messages
3. Look at the backend logs for extraction failures
4. Review [TROUBLESHOOTING.md](TROUBLESHOOTING.md) for common issues

## Example: Good vs. Bad PDFs

### ✅ Good (Text-Based PDF)
```
Created in: Microsoft Word → Save as PDF
File size: Usually smaller for text
Selection: Text can be selected
Extraction: Works perfectly
```

### ❌ Bad (Image-Based PDF)
```
Created in: Scanner → Scan to PDF
File size: Usually larger (image data)
Selection: Cannot select text
Extraction: Fails with "No text extracted"
```

---

**Remember**: If you can't select text in the PDF with your mouse, the system won't be able to extract it either!
